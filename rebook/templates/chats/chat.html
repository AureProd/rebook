{% extends "base.html" %}

{% block title %}My Chats / {{ block.super }}{% endblock %}

{% block content %}
    <form action="{% url 'delete_chat' chat.id %}" method="POST">
        {% csrf_token %}

        <button type="submit">Delete the chat</button>
    </form>

    <h1>
        {% if chat.purchaser == user %}
            Chat with {{ chat.post.seller.username }}
        {% else %}
            Chat with {{ chat.purchaser.username }}
        {% endif %}
    </h1>

    <p>For post : <a href="{% url 'post_detail' chat.post.id %}">{{ chat.post.title }}</a></p>

    <h2>Messages</h2>

    {% if chat.messages.all %}
        <ul>
            {% for message in chat.messages.all %}
                <li>
                    <p>{{ message.message }}</p>
                    <p>
                        {% if message.sender == user %}
                            Sender : You
                        {% else %}
                            Sender : {{ message.sender.username }}
                        {% endif %}
                    </p>
                    <p>Send at : {{ message.send_at }}</p>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No messages found !!!</p>
    {% endif %}
{% endblock %}
